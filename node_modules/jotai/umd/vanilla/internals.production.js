!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanillaInternals={})}(this,function(n){"use strict";function e(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=Array(e);r<e;r++)t[r]=n[r];return t}function r(n,r){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(t)return(t=t.call(n)).next.bind(t);if(Array.isArray(n)||(t=function(n,r){if(n){if("string"==typeof n)return e(n,r);var t={}.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e(n,r):void 0}}(n))||r){t&&(n=t);var a=0;return function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function t(n){return"init"in n}function a(n){return!!n.write}function o(n){return"v"in n||"e"in n}function i(n){if("e"in n)throw n.e;return n.v}function u(n){return"function"==typeof(null==n?void 0:n.then)}function f(n,e,r){if(!r.p.has(n)){r.p.add(n);var t=function(){return r.p.delete(n)};e.then(t,t)}}function l(n,e,t){for(var a,o=new Set,i=r((null==(u=t.get(n))?void 0:u.t)||[]);!(a=i()).done;){var u,f=a.value;o.add(f)}for(var l,d=r(e.p);!(l=d()).done;){var v=l.value;o.add(v)}return o}var d=function(){var n={},e=new WeakMap,r=function(r){var t,a;null==(t=e.get(n))||t.forEach(function(n){return n(r)}),null==(a=e.get(r))||a.forEach(function(n){return n()})};return r.add=function(r,t){var a=r||n,o=e.get(a);return o||(o=new Set,e.set(a,o)),o.add(t),function(){o.delete(t),o.size||e.delete(a)}},r};var v=function(n,e){for(var r=arguments.length,t=new Array(r>2?r-2:0),a=2;a<r;a++)t[a-2]=arguments[a];return e.read.apply(e,t)},c=function(n,e){for(var r=arguments.length,t=new Array(r>2?r-2:0),a=2;a<r;a++)t[a-2]=arguments[a];return e.write.apply(e,t)},s=function(n,e){return null==e.INTERNAL_onInit?void 0:e.INTERNAL_onInit(n)},y=function(n,e,r){return null==e.onMount?void 0:e.onMount(r)},h=function(n,e){var r=_(n),t=r[0],a=r[6],o=r[9],i=t.get(e);return i||(i={d:new Map,p:new Set,n:0},t.set(e,i),null==a.i||a.i(e),null==o||o(n,e)),i},p=function(n){var e=_(n),r=e[1],t=e[3],a=e[4],o=e[5],i=e[6],u=e[13],f=[],l=function(n){try{n()}catch(n){f.push(n)}},d=function(){i.f&&l(i.f);var e=new Set,f=e.add.bind(e);t.forEach(function(n){var e;return null==(e=r.get(n))?void 0:e.l.forEach(f)}),t.clear(),o.forEach(f),o.clear(),a.forEach(f),a.clear(),e.forEach(l),t.size&&u(n)};do{d()}while(t.size||o.size||a.size);if(f.length)throw new AggregateError(f)},g=function(n){for(var e=_(n),t=e[1],a=e[2],o=e[3],i=e[11],u=e[14],f=e[17],d=[],v=new WeakSet,c=new WeakSet,s=Array.from(o);s.length;){var y=s[s.length-1],h=i(n,y);if(c.has(y))s.pop();else if(v.has(y))a.get(y)===h.n&&d.push([y,h]),c.add(y),s.pop();else{v.add(y);for(var p,g=r(l(y,h,t));!(p=g()).done;){var w=p.value;v.has(w)||s.push(w)}}}for(var A=d.length-1;A>=0;--A){for(var m,E=d[A],S=E[0],b=!1,N=r(E[1].d.keys());!(m=N()).done;){var k=m.value;if(k!==S&&o.has(k)){b=!0;break}}b&&(u(n,S),f(n,S)),a.delete(S)}},w=(new WeakSet,function(n,e){var l=_(n),d=l[1],v=l[2],c=l[3],s=l[6],y=l[7],h=l[11],p=l[12],g=l[13],w=l[14],A=l[16],m=l[17],E=l[20],S=l[26],b=h(n,e);if(o(b)){if(d.has(e)&&v.get(e)!==b.n)return b;for(var N,k=!1,I=r(b.d);!(N=I()).done;){var T=N.value,R=T[0],L=T[1];if(w(n,R).n!==L){k=!0;break}}if(!k)return b}var M,z,W=!0,j=new Set(b.d.keys()),x=new Map,O=function(){for(var n,e=r(j);!(n=e()).done;){var t=n.value;x.has(t)||b.d.delete(t)}},P=function(){if(d.has(e)){var r=!c.size;m(n,e),r&&(g(n),p(n))}},V={get signal(){return M||(M=new AbortController),M.signal},get setSelf(){return!z&&a(e)&&(z=function(){if(!W)try{for(var r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return A.apply(void 0,[n,e].concat(t))}finally{g(n),p(n)}}),z}},B=b.n;try{0;var C=y(n,e,function(r){if(r===e){var a=h(n,r);if(!o(a)){if(!t(r))throw new Error("no atom init");E(n,r,r.init)}return i(a)}var l=w(n,r);try{return i(l)}finally{var v;x.set(r,l.n),b.d.set(r,l.n),u(b.v)&&f(e,b.v,l),d.has(e)&&(null==(v=d.get(r))||v.t.add(e)),W||P()}},V);if(E(n,e,C),u(C)){S(n,C,function(){var n;return null==(n=M)?void 0:n.abort()});var D=function(){O(),P()};C.then(D,D)}else O();return null==s.r||s.r(e),b}catch(n){return delete b.v,b.e=n,++b.n,b}finally{W=!1,B!==b.n&&v.get(e)===B&&(v.set(e,b.n),c.add(e),null==s.c||s.c(e))}}),A=function(n,e){for(var t=_(n),a=t[1],o=t[2],i=t[11],u=[e];u.length;)for(var f,d=u.pop(),v=r(l(d,i(n,d),a));!(f=v()).done;){var c=f.value,s=i(n,c);o.get(c)!==s.n&&(o.set(c,s.n),u.push(c))}},m=function(n,e){var r=_(n),a=r[3],o=r[6],u=r[8],f=r[11],l=r[12],d=r[13],v=r[14],c=r[15],s=r[16],y=r[17],h=r[20],p=!0;try{for(var g=arguments.length,w=new Array(g>2?g-2:0),A=2;A<g;A++)w[A-2]=arguments[A];return u.apply(void 0,[n,e,function(e){return i(v(n,e))},function(r){var i=f(n,r);try{for(var u=arguments.length,v=new Array(u>1?u-1:0),g=1;g<u;g++)v[g-1]=arguments[g];if(r===e){if(!t(r))throw new Error("atom not writable");var w=i.n,A=v[0];return h(n,r,A),y(n,r),void(w!==i.n&&(a.add(r),c(n,r),null==o.c||o.c(r)))}return s.apply(void 0,[n,r].concat(v))}finally{p||(d(n),l(n))}}].concat(w))}finally{p=!1}},E=function(n,e){var t=_(n),a=t[1],o=t[3],i=t[6],u=t[11],f=t[15],l=t[18],d=t[19],v=u(n,e),c=a.get(e);if(c){for(var s,y=r(v.d);!(s=y()).done;){var h=s.value,p=h[0],g=h[1];if(!c.d.has(p)){var w=u(n,p);l(n,p).t.add(e),c.d.add(p),g!==w.n&&(o.add(p),f(n,p),null==i.c||i.c(p))}}for(var A,m=r(c.d);!(A=m()).done;){var E=A.value;if(!v.d.has(E)){c.d.delete(E);var S=d(n,E);null==S||S.t.delete(e)}}}},S=function(n,e){var t=_(n),o=t[1],i=t[4],u=t[6],f=t[10],l=t[11],d=t[12],v=t[13],c=t[14],s=t[16],y=t[18],h=l(n,e),p=o.get(e);if(!p){c(n,e);for(var g,w=r(h.d.keys());!(g=w()).done;){var A=g.value;y(n,A).t.add(e)}if(p={l:new Set,d:new Set(h.d.keys()),t:new Set},o.set(e,p),a(e)){i.add(function(){var r=!0;try{var t=f(n,e,function(){try{for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return s.apply(void 0,[n,e].concat(a))}finally{r||(v(n),d(n))}});t&&(p.u=function(){r=!0;try{t()}finally{r=!1}})}finally{r=!1}})}null==u.m||u.m(e)}return p},b=function(n,e){var t=_(n),a=t[1],o=t[5],i=t[6],u=t[11],f=t[19],l=u(n,e),d=a.get(e);if(!d||d.l.size)return d;for(var v,c=!1,s=r(d.t);!(v=s()).done;){var y,h=v.value;if(null!=(y=a.get(h))&&y.d.has(e)){c=!0;break}}if(c)return d;d.u&&o.add(d.u),d=void 0,a.delete(e);for(var p,g=r(l.d.keys());!(p=g()).done;){var w=f(n,p.value);null==w||w.t.delete(e)}null==i.u||i.u(e)},N=function(n,e,t){var a=_(n),o=a[11],i=a[27],l=o(n,e),d="v"in l,v=l.v;if(u(t))for(var c,s=r(l.d.keys());!(c=s()).done;){f(e,t,o(n,c.value))}l.v=t,delete l.e,d&&Object.is(v,l.v)||(++l.n,u(v)&&i(n,v))},k=function(n,e){return i((0,_(n)[14])(n,e))},I=function(n,e){var r=_(n),t=r[12],a=r[13],o=r[16];try{for(var i=arguments.length,u=new Array(i>2?i-2:0),f=2;f<i;f++)u[f-2]=arguments[f];return o.apply(void 0,[n,e].concat(u))}finally{a(n),t(n)}},T=function(n,e,r){var t=_(n),a=t[12],o=t[18],i=t[19],u=o(n,e).l;return u.add(r),a(n),function(){u.delete(r),i(n,e),a(n)}},R=function(n,e,r){var t=_(n)[25],a=t.get(e);if(!a){a=new Set,t.set(e,a);var o=function(){return t.delete(e)};e.then(o,o)}a.add(r)},L=function(n,e){var r=_(n)[25].get(e);null==r||r.forEach(function(n){return n()})},M=new WeakMap,_=function(n){return M.get(n)};n.INTERNAL_addPendingPromiseToDependency=f,n.INTERNAL_buildStoreRev2=function(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];var t={get:function(n){return(0,_(t)[21])(t,n)},set:function(n){for(var e=_(t)[22],r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return e.apply(void 0,[t,n].concat(a))},sub:function(n,e){return(0,_(t)[23])(t,n,e)}},a=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},v,c,s,y,h,p,g,w,A,m,E,S,b,N,k,I,T,void 0,new WeakMap,R,L].map(function(n,r){return e[r]||n});return M.set(t,Object.freeze(a)),t},n.INTERNAL_getBuildingBlocksRev2=function(n){var e=_(n),r=e[24];return r?r(e):e},n.INTERNAL_getMountedOrPendingDependents=l,n.INTERNAL_hasInitialValue=t,n.INTERNAL_initializeStoreHooksRev2=function(n){var e,r,t,a,o,i,u,f;return(e=n).i||(e.i=d()),(r=n).r||(r.r=d()),(t=n).c||(t.c=d()),(a=n).m||(a.m=d()),(o=n).u||(o.u=d()),(i=n).f||(i.f=(u=new Set,(f=function(){return u.forEach(function(n){return n()})}).add=function(n){return u.add(n),function(){return u.delete(n)}},f)),n},n.INTERNAL_isActuallyWritableAtom=a,n.INTERNAL_isAtomStateInitialized=o,n.INTERNAL_isPromiseLike=u,n.INTERNAL_returnAtomValue=i});
